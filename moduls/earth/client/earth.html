<template name="earth">
  <div id="map-content" class="information">
    <div id="map-earth"></div>
  </div>
</template>

<template name="earthHistory">
  <div class="history">
    {{#if battles}}
      <table>
        <tr class="header">
          <th class="sides">Событие</th>
          <th class="result">Итог</th>
          <th class="time">Время</th>
        </tr>
      </table>
      <div class="data">
        <table>
          {{#each battles}}
            <tr data-id="{{this._id}}">
              <td>
                {{#if eq this.moveType 'wait'}}
                  <span class="humans">Консулы</span>
                   остаются на точке 
                  <span class="humans">{{this.location}}</span>
                {{/if}}

                {{#if eq this.moveType 'defend'}}
                  <span class="reptiles">Рептилоиды ({{this.enemyLocation}})</span>
                   атакуют 
                  <span class="humans">Консулов ({{this.userLocation}})</span>
                {{/if}}

                {{#if eq this.moveType 'move'}}
                  {{#if this.enemyArmy}}
                    <span class="humans">Консулы ({{this.userLocation}})</span>
                     атакуют 
                    <span class="reptiles">Рептилоидов ({{this.enemyLocation}})</span>
                  {{else}}
                    <span class="humans">Консулы</span>
                     переходят на точку 
                    <span class="humans">{{this.location}}</span>
                  {{/if}}
                {{/if}}

                {{#if eq this.moveType 'fight'}}
                  <span class="humans">Консулы</span>
                   продолжают бой с 
                  <span class="reptiles">рептилоидами</span>
                   на точке 
                  <span class="reptiles">{{this.location}}</span>
                {{/if}}

                {{#if eq this.moveType 'retreat'}}
                  <span class="humans">Консулы</span>
                   оступают с точки 
                  <span class="reptiles">{{this.location}}</span>
                {{/if}}
              </td>
              <td>
                {{#if eq this.result 0}}Тактическая ничья{{/if}}
                {{#if eq this.result 1}}Героическая победа{{/if}}
                {{#if eq this.result 2}}Полное поражение{{/if}}
              </td>
              <td>{{formatDate this.timestamp}}</td>
            </tr>
          {{/each}}
        </table>
      </div>
      {{> pages total=countTotal perPage=countPerPage}}
    {{else}}
      {{#if lt countTotal 1}}
        <h2>История боев пуста</h2>
      {{/if}}
    {{/if}}
    <a class="btn-close" href="{{pathFor 'earth' group='earth'}}" data-sound="close"></a>
  </div>

  {{#if battle}}
    {{> earthHistoryItem battle=battle}}
  {{/if}}

  {{#if isLoading}}
    {{> loading}}
  {{/if}}
</template>

<template name="earthHistoryItem">
  <div class="history-item">
    {{#if battle}}
      <div
        class="
          result
          {{#if eq battle.result 0}}tie{{/if}}
          {{#if eq battle.result 1}}victory{{/if}}
          {{#if eq battle.result 2}}defeat{{/if}}
        "
      >
        {{#if eq battle.result 0}}Тактическая ничья{{/if}}
        {{#if eq battle.result 1}}Героическая победа{{/if}}
        {{#if eq battle.result 2}}Полное поражение{{/if}}
      </div>
      {{#if battle.userArmy}}
        <div class="user-army">
          <p class="humans">Люди</p>
          <table>
            <tr class="header">
              <th class="name"></th>
              <th class="count">Было</th>
              <th class="count">Осталось</th>
            </tr>
            {{#each (getArmyInfo battle.userArmy battle.userArmyRest)}}
              <tr>
                <td class="name humans">{{this.name}}</td>
                <td class="count">{{formatNumberWithISO this.start}}</td>
                <td class="count">{{formatNumberWithISO this.end}}</td>
              </tr>
            {{/each}}
          </table>
        </div>
      {{/if}}
      {{#if battle.enemyArmy}}
        <div class="enemy-army">
          <p class="reptiles">Рептилоиды</p>
          <table>
            <tr class="header">
              <th class="count">Осталось</th>
              <th class="count">Было</th>
              <th class="name"></th>
            </tr>
            {{#each (getArmyInfo battle.enemyArmy battle.enemyArmyRest)}}
              <tr>
                <td class="count">{{formatNumberWithISO this.end}}</td>
                <td class="count">{{formatNumberWithISO this.start}}</td>
                <td class="name reptiles">{{this.name}}</td>
              </tr>
            {{/each}}
          </table>
        </div>
      {{/if}}
    {{/if}}
    <a class="btn-back" href="{{pathFor 'earthHistory' group='earth' page=currentPage}}" data-sound="click"></a>
  </div>
</template>
