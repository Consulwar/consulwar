<template name="top_menu">
	<ul class="top_menu">
		<li><a href="{{pathFor 'chat' room=chatRoom}}">Чат</a></li>
		<li><a href="{{pathFor 'statistics' type='general'}}">Статистика</a></li>
		<li><a href="{{pathFor 'settings'}}">Настройки</a></li>
		<li><a href="javascript: ShowModalWindow(Template.support)">Служба поддержки</a></li>
		<li><a href="http://ru.consulwar.wikia.com" target="_blank">Вики</a></li>
		<li><a href="{{pathFor 'logout'}}">Выход</a></li>
	</ul>
</template>

<template name="main_menu">
	<div class="menu">
		<ul class="main_menu">
			{{#each menu}}
				<li 
					class="{{this.additionalClass}}{{#if this.isActive}} active{{/if}} {{this.engName}}"
					data-tooltip="{{this.name}}"
					data-tooltip-direction="s"
				>
					<a href="{{this.url}}">
						<img alt="{{this.name}}" src="/img/game/menu/{{this.engName}}.png"/>
					</a>
				</li>
			{{/each}}
		</ul>
		{{> side_menu}}
	</div>
</template>

<template name="side_menu">
	{{#if (sides showHidden)}}
		<ul class="second_menu">
			{{#each (sides showHidden)}}
				<li 
					class="{{this.engName}}-icon{{#if this.isActive}} active{{/if}}{{#if this.progress}} progress{{/if}}"
					data-tooltip="{{this.tooltip}}"
				>
					<a href="{{getUrl this}}">{{this.name}}</a>
				</li>
			{{/each}}
		</ul>
	{{/if}}
</template>

<template name="additional_area">
	{{#if sideHero}}
		<div 
			class="
				additional_area 
				quest
				{{sideHero}} 
				{{#if gt status -1}}
					{{#if eq status 0}}prompt{{/if}}
					{{#if eq status 3}}finished{{/if}}
				{{/if}}"
		>
			{{#if sideHeroName}}
				<span class="title">{{sideHeroName}}</span>
			{{/if}}
			{{#if quests}}
				{{#if isOpened}}
					<ul class="quests">
						{{#each quests}}
							<li 
								data-id="{{this.engName}}"
								class="
									{{#if eq this.status 0}}prompt{{/if}}
									{{#if eq this.status 1}}inprogress{{/if}}
									{{#if eq this.status 3}}finished{{/if}}"
							>
								{{this.name}}
							</li>
						{{/each}}
					</ul>
				{{/if}}
				<a class="quests-switch {{#if isOpened}}close{{else}}open{{/if}}"></a>
			{{/if}}
		</div>
	{{/if}}
</template>

<template name="items_menu">
	<ul class="bottom_menu items">
		{{#each items}}
			{{#let progress=this.progress}}
				<li 
					class="{{#if isPartOfUrl currentUrl this.url}}active{{/if}}{{#if progress}} progress{{/if}}{{#unless this.meetRequirements}} disabled{{/unless}}{{#if this.isEnoughResources}} enough_resources{{/if}} {{this.type}} {{#if this.star}}star{{this.star}}{{/if}}" 
					data-tooltip="{{this.name}}"
					data-tooltip-direction="n"
				>
					<a 
						class="{{this.engName}}-icon" 
						href="{{this.url}}"
						data-remaining="{{#if progress}}{{formatSeconds (substract progress.finishTime serverTime)}}{{/if}}"
					>
						{{#if this.currentLevel}}
							<span class="{{#if eq this.type 'unit'}}count{{else}}level{{/if}}">
								{{formatNumberWithISO this.currentLevel 3}}
							</span>
						{{/if}}
					</a>
				</li>
			{{/let}}
		{{/each}}
	</ul>
</template>

<template name="overlay_menu">
	{{#if and isNewLayout item}}
		<div class="overlay {{menuGroup}} {{itemGroup}} item {{item.engName}} {{#if options.hideNet}}hideNet{{/if}}">
			<div 
				class="item" 
				style="background-image: url(/img/game/{{item.type}}/{{item.group}}/{{item.engName}}/{{or item.overlay.own 'item'}}.png)"></div>
		</div>

								<!--class="{{#if and item (not (eq this.engName item.engName))}}blur{{/if}}"-->
	{{else}}
		<div class="overlay {{menuGroup}} {{itemGroup}} {{item.engName}} {{#if options.hideNet}}hideNet{{/if}}">
			{{#each items}}
				{{#if this.overlay}}
					{{#let overlay=this.getOverlay}}
						{{#if and (overlay (or overlay.img overlay.progress))}}
							<a 
								href="{{this.url}}"
								title="{{this.name}}"
								style="
									top: {{overlay.y}}px;
									left: {{overlay.x}}px;
									z-index: {{overlay.z}};
								" 
								>

								{{#if overlay.img}}
									<img src="/img/game/{{overlay.img}}" alt=""/>
								{{/if}}

								{{#if and overlay.progress (not (eq overlay.img overlay.progress.img))}}
									<img 
										src="/img/game/{{overlay.progress.img}}" 
										progress="{{percentRound10 overlay.progress}}" 
										alt=""/>
								{{/if}}
							</a>
						{{/if}}
					{{/let}}
				{{else}}
					{{#if gt this.currentLevel 0}}
						<a href="{{this.url}}" class="{{this.engName}}-icon" title="{{this.name}}"></a>
					{{/if}}
					
					{{#let progress=this.progress}}
						{{#if and progress (eq progress.level 1)}}
							<a class="{{progress.engName}}-icon" title="{{progress.name}}" progress="{{percentRound10 progress}}"></a>
						{{/if}}
					{{/let}}
				{{/if}}
			{{/each}}
			
			{{#if eq currentUrl (pathFor route='building' group='residential')}}
				<progress class="metals {{#with multiply income.metals 0.25}}{{#if gt resources.metals.bonus this}}active{{/if}}{{/with}}" max="{{multiply income.metals bonusStorage}}" value="{{or resources.metals.bonus '0'}}"></progress>
				<progress class="crystals {{#with multiply income.crystals 0.25}}{{#if gt resources.crystals.bonus this}}active{{/if}}{{/with}}" max="{{multiply income.crystals bonusStorage}}" value="{{or resources.crystals.bonus '0'}}"></progress>
			{{/if}}
		</div>
	{{/if}}
</template>