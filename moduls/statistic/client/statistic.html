<template name="rating">
	<div class="rating">
		{{#if users}}
			<table>
				<tr class="header">
					<th>Место</th>
					<th>Ник</th>
					<th>Награды</th>
					<th>Действия</th>
					<th>Рейтинг</th>
				</tr>
			</table>
			<div class="data">
				<table>
					{{#each users}}
					<tr 
						class="
							{{#if eq this.username selectedUserName}}selectedUser{{/if}}
							{{#if eq this.username user.username}}me{{/if}}
							" 
						id="{{this._id}}"
					>
						<td>{{this.place}}</td>
						<td>{{this.username}}</td>
						<td>
							{{#if gt this.rating 25000}}
								<img src="/img/game/battle/statistics/{{rank this.rating}}.png"/>
							{{/if}}
							{{#each (achievements this)}}
								<img 
									src="
										/img/game/achievements/{{this.engName}}
										{{#if gt this.maxLevel 1}}{{this.currentLevel}}{{/if}}.png
										" 
									alt="{{this.name}}" 
									data-tooltip="
										<div class='title'>{{this.name}}</div>
										<div class='text'>{{this.description}}</div>
										{{#if this.effect}}
											{{#each this.effect}}
												{{#if (this.result ../currentLevel)}}
													<div class='effect'>
														{{this.pretext}}
														{{this.result ../currentLevel}}
														{{this.aftertext}}
													</div>
												{{/if}}
											{{/each}}
										{{/if}}
										"
								/>
							{{/each}}
						</td>
						<td>
							<a
								class="send_message"
								href="{{pathFor 'mail' page=1 hash=(mailHash this.username)}}"
								data-tooltip="Написать сообщение"
							>
								<img src="/img/game/message.png">
							</a>
							<a
								class="open_house"
								href="{{pathFor 'house' group='house' hash=this.username}}"
								data-tooltip="Смотреь палату"
							>
								<img src="/img/game/house.png">
							</a>
							<a
								class="show_detail_statistic"
								href="{{detailStatisticRoute this.username}}"
								data-tooltip="Смотреть подробную статистику"
							>
								<img src="/img/game/detail_statistic.png">
							</a>
						</td>
						<td>{{formatNumber this.rating}}</td>
					</tr>
					{{/each}}
				</table>
				{{#if isLoading}}
					{{> loading}}
				{{/if}}
			</div>
			<div class="
				button returnToMe 
				{{#if eq user.username selectedUserName}}active{{/if}}
			"></div>
			<div class="
				button search
				{{#if and selectedUserName (not (eq user.username selectedUserName))}}active{{/if}}
			"></div>
			<input type="text" name="searchUserInRating" placeholder="Имя консула">
			{{> pages total=countTotal perPage=countPerPage}}
		{{else}}
			<h2>Нет статистики</h2>
		{{/if}}
		{{#if detailStatisticView}}
			{{> detailStatistic}}
		{{/if}}
	</div>
</template>

<template name="detailStatistic">
	<div class="smoke"></div>
	<div class="detailStatistic">
		<div class="close"></div>

		<div class="tabs">
			<div class="tab development active" data-name="development">Развитие{{data1}}</div>
			<div class="tab war" data-name="war">Боевые</div>
			<div class="tab consul" data-name="consul">Консул</div>
			<div class="tab another" data-name="another">Другое</div>
		</div>
		<div class="page development">
			<ul>
				{{#each developmentTexts}}
					<li>
						<span>{{this}}</span>
					</li>
				{{/each}}
			</ul>
		</div>

		<div class="page war">
			
		</div>

		<div class="page consul">
			
		</div>

		<div class="page another">
			
		</div>
	</div>
</template>