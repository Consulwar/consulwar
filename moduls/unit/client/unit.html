<template name="unit">
  <div class="header">
    <div class="level">
      {{#if (currentValue unit)}}
        <span>{{formatNumber (currentValue unit)}} </span>
        {{declension (currentValue unit) 'единиц' 'а' 'ы' ''}} 
      {{else}}
        Не построено
      {{/if}}
    </div>

    <div class="name {{#if unit.getStar}}star{{unit.getStar}}{{/if}}">
      {{unit.title}}
    </div>

    <button 
      class="
        toggle_description 
        {{#if not options.hideDescription}}active{{/if}}
      "
    ></button>
    <a href="{{backToGroupLink}}" class="close"></a>
  </div>

  <div 
    class="description" 
    style="{{#if options.hideDescription}}display: none;{{/if}}">
    <div class="scrollbar-inner">{{unit.description}}</div>
  </div>

  <div class="item_info">

    {{> unitCharacteristics unit=unit}}

    {{#unless eq unit.type 'reptileUnit'}}
      <div class="bottom">
        {{> item_price price=(unit.getPrice count undefined)}}

        <div class="actions">
          <div class="action">
            <button 
              class="max" 
              {{notPremiumDisabled}}
              data-tooltip="Ввести максимум"
              data-tooltip-direction="s"
              {{premiumTitle}}></button>
            <input class="count" type="number" placeholder="Количество" value="{{count}}"/>
            <button class="main_action build" disabled="{{not (unit.canBuild count undefined)}}">Отдать приказ</button>
          </div>
          
          {{#unless eq unit.group 'Ground'}}
            <div class="action">
              <button class="additional_action repair">
                Ремонтировать
              </button>
            </div>
          {{/unless}}
        </div>
      </div>
    {{/unless}}
  </div>
  {{> item_requirements requirements=unit.getRequirements}}
</template>

<template name="unitCharacteristics">
  {{#if unit.characteristics}}
    <div class="unit">
      {{#if addTitle}}
        <div class="title">
          {{unit.title}}
        </div>
      {{/if}}

      <div class="characteristics">
        <div class="weapon">
          <div class="damage" data-tooltip="true" data-tooltip-direction="w">
            {{formatNumberWithISO (div (sum unit.getCharacteristics.weapon.damage.min unit.getCharacteristics.weapon.damage.max) 2) 4}}
          </div>

          <div class="damage_signature">
            {{formatNumberWithISO unit.getCharacteristics.weapon.signature 4}}
          </div>
        </div>

        <div class="life">
          <div class="armor" data-tooltip="true" data-tooltip-direction="w">
            {{formatNumberWithISO unit.getCharacteristics.health.armor 4}}
          </div>

          <div class="armor_signature">
            {{formatNumberWithISO unit.getCharacteristics.health.signature 4}}
          </div>
        </div>
      </div>

      {{#if unit.getTargets}}
        <div class="targets_title">Приоритеты атаки:</div>
        <ol class="targets">
          {{#each unit.getTargets}}
            <li 
              class="enough_resources {{this.type}}" 
              data-tooltip="true"
              data-tooltip-direction="s"
            >
              <a 
                href="{{this.url}}"
                style="background-image: url({{this.icon}});"
              ></a>
            </li>
          {{/each}}
        </ol>
      {{/if}}

      <div class="effects">
        {{#if unit.maxCount}}
          <div class="limit">
            Всего юнитов {{formatNumber unit.getTotalCount}} из {{formatNumber unit.maxCount}}
          </div>
        {{/if}}
      </div>
    </div>
  {{/if}}
</template>