<template name="unit">
	{{#if isNewLayout}}
		<div class="header">
			<div class="level">
				{{#if unit.currentLevel}}
					<span>{{formatNumber unit.currentLevel}} </span>
					{{declension unit.currentLevel 'единиц' 'а' 'ы' ''}} 
				{{else}}
					Не построено
				{{/if}}
			</div>

			<div class="name {{#if unit.star}}star{{unit.star}}{{/if}}">
				{{unit.name}}
			</div>

			<button 
				class="
					toggle_description 
					{{#if not options.hideDescription}}active{{/if}}
				"
			></button>
			<a href="{{backToGroupLink}}" class="close"></a>
		</div>

		<div 
			class="description" 
			style="{{#if options.hideDescription}}display: none;{{/if}}">
			<div class="scrollbar-inner">{{unit.description}}</div>
		</div>

		<div class="item_info">

			{{> unitCharacteristics unit=unit showTooltip=true}}

			<div class="bottom">
				{{> item_price price=(unit.price count)}}

				<div class="actions">
					<div class="action">
						<button 
							class="max" 
							{{notPremiumDisabled}}
							data-tooltip="Ввести максимум"
							data-tooltip-direction="s"
							{{premiumTitle}}></button>
						<input class="count" type="number" placeholder="Количество" value="{{count}}"/>
						<button class="main_action build" disabled="{{not (unit.canBuild count)}}">Отдать приказ</button>
					</div>
				</div>
			</div> 
		</div>
		{{> item_requirements requirements=unit.requirements}}
	{{else}}

		<div class="information {{unit.type}}">
			<div class="image">
				<img 
					alt="{{unit.name}}" 
					src="
					{{#unless unit.notImplemented}}
						/img/game/unit/{{unit.side}}/{{unit.group}}/{{unit.engName}}.jpg
					{{else}}
						/img/game/notimplemented.jpg
					{{/unless}}
					"
				>
				<span class="title">{{unit.name}}</span>
				{{#if unit.currentLevel}}
					<span class="level" title="{{formatNumber unit.currentLevel}}">
						{{formatNumberWithISO unit.currentLevel}} 
						{{declension unit.currentLevel 'юнит' '' 'а' 'ов'}}
					</span>
				{{/if}}
			</div>
			<div class="description">
				{{> item_requirements requirements=unit.requirements}}

				<p>{{unit.description}}</p>
				
				{{> unitBattleEffects unit=unit}}

				{{#if unit.maxCount}}
					<div class="limit">
						Всего юнитов {{formatNumber unit.totalCount}} из {{formatNumber unit.maxCount}}
					</div>
				{{/if}}
			</div>

			{{> item_characteristic item=unit}}
			
			{{#unless eq unit.side 'reptiles'}}
				{{> item_price price=(unit.price count)}}

				<input class="count" type="number" placeholder="Количество" value="1"/>

				<button class="build" disabled="{{not (unit.canBuild count)}}">Отдать приказ</button>
			{{/unless}}
			
			{{> Template.dynamic template=additionalArea}}
		</div>
	{{/if}}
</template>

<template name="unitCharacteristics">
	{{#if unit.characteristics}}
		<div class="unit">
			{{#if addTitle}}
				<div class="title">
					{{unit.name}}
				</div>
			{{/if}}

			<div class="characteristics">
				{{#if unit.characteristics.damage}}
					<div class="weapon">
						<div class="damage" {{militaryTooltip unit.characteristics 'damage'}}>
							{{formatNumberWithISO (div (sum unit.characteristics.damage.min unit.characteristics.damage.max) 2) 4}}
						</div>

						<div class="damage_signature">100
							{{formatNumberWithISO unit.characteristics.damage.signature 4}}
						</div>
					</div>
				{{/if}}
				<div class="life">
					<div class="armor" {{militaryTooltip unit.characteristics 'life'}}>
						{{formatNumberWithISO unit.characteristics.life 4}}
					</div>

					<div class="armor_signature">100
						{{formatNumberWithISO unit.characteristics.signature 4}}
					</div>
				</div>
			</div>

			{{#if unit.targets}}
				<div class="targets_title">Приоритеты атаки:</div>
				<ol class="targets">
					{{#each unit.targets}}
						<li 
							class="enough_resources {{this.type}}" 
							data-tooltip="{{#if ../showTooltip}}{{> unitCharacteristics unit=this addTitle=true}}{{/if}}"
							data-tooltip-direction="s"
						>
							<a 
								class="{{this.engName}}-icon" 
								href="{{this.url}}"
							></a>
						</li>
					{{/each}}
				</ol>
			{{/if}}

			<div class="effects">
				{{> unitBattleEffects unit=unit}}

				{{#if unit.maxCount}}
					<div class="limit">
						Всего юнитов {{formatNumber unit.totalCount}} из {{formatNumber unit.maxCount}}
					</div>
				{{/if}}
			</div>
		</div>
	{{/if}}
</template>

<template name="unitBattleEffects">
	{{#if unit.battleEffects}}
		<div class="currentLevel">
			{{#each unit.battleEffects}}
				{{#if result}}
					{{name}}{{pretext}}{{formatNumber result}}{{aftertext}} 
					{{#if notImplemented}}<span class="notImplemented">В разработке!</span>{{/if}}
					<br/>
				{{/if}}
			{{/each}}
		</div>
	{{/if}}
</template>