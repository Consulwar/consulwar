<template name="payment">
	<div class="smoke"></div>
	<div class="payment_wrapper">
		<div class="payment scrollbar-inner">
			<span>
				<span class="alert">Помните Консулы:</span> 
				покупая 
				<span class="ggk">Грязные Галактические Кредиты</span> 
				— вы поддерживаете 
				<span class="alert">Борьбу за освобождение Земли от Рептилоидов</span>
			</span>
			<div class="close"></div>
			<div class="paymentItems">
				{{#each paymentItems}}
					<div class="{{this.id}}-icon">
						<div class="description">
							Кредиты: <span>{{formatNumber this.result.base}}</span>
							{{#if this.result.bonus}}
								+ 
								<span>{{formatNumber this.result.bonus}}</span>
							{{/if}}
							{{#if this.result.extra}}
								+ 
								<span>{{formatNumber this.result.extra}}</span>
							{{/if}}
						</div>
						<div class="profit">
							{{formatNumber this.profit.resources.credits}}
							{{#if this.result.extra}}
								<span class="previous">
									{{formatNumber (sum this.result.base (or this.result.bonus 0))}}
								</span>
							{{/if}}
						</div>
						<div class="price">
							{{formatNumber this.cost.rub}}
						</div>
						
						<button class="greenButton" data-id="{{this.id}}">
							Приобрести
						</button>
					</div>
				{{/each}}
			</div>
		</div>
	</div>
</template>

<template name="paymentPlatbox">
	<div class="smoke"></div>
	<div class="payment_wrapper">
		<div class="payment platbox">
			<div class="close"></div>
			<iframe src="{{url}}"></iframe>
		</div>
	</div>
</template>

<template name="paymentReward">
	<div class="smoke reward"></div>
	<div class="payment reward">
		<div class="close"></div>
		<img src="/img/game/quests/credits.png">
		<div class="count">{{formatNumber item.profit.resources.credits}}</div>
		<div class="description">{{item.description}}</div>
		<div class="take">Забрать</div>
	</div>
</template>

<template name="paymentSide">
	<div class="side_payment">
		<h2>Грязные галактические кредиты</h2>
		<div class="buy">
			Покупая <span class="yellow">Кредиты</span> ты поддерживаешь независимого <span class="blue">российского разработчика.</span>
		</div>
		<a href="{{pathFor 'walletHistory' type='income' page=1}}">История покупок</a>
		<a href="{{pathFor 'walletHistory' type='expense' page=1}}">История расходов</a>
		<div class="promo">
			{{#if isAdmin}}
				<span class="create">Создать промо код</span>
				<a href="{{pathFor 'promocodeHistory' page=1}}" class="promoHistory">История промо кодов</a>
			{{/if}}
			<span class="hint">Введите промо код, если он у вас конечно есть</span>
			<input class="code"/>
			<span class="send">Награда</span>
		</div>
	</div>
</template>

<template name="paymentHistory">
	<div class="paymentHistory">
		<a class="btn-close" href="{{pathFor 'house' group='house'}}"></a>

		{{#if isIncome}}

			<table>
				<tr class="header">
					<th>Время</th>
					<th>Получено</th>
					<th></th>
				</tr>
			</table>
			<div class="data">
				<table>
					{{#each history}}
						<tr>
							<td>{{formatDate this.timestamp}}</td>
							<td>{{formatProfit this.profit}}</td>
							<td>
								{{#if eq this.source.type 'payment'}}
									Покупка: {{this.source.item}}
								{{/if}}
								{{#if eq this.source.type 'promo'}}
									Промо код: {{this.source.code}}
								{{/if}}
							</td>
						</tr>
					{{/each}}
				</table>
			</div>

		{{else}}

			<table>
				<tr class="header">
					<th>Время</th>
					<th>Потрачено кредитов</th>
					<th></th>
				</tr>
			</table>
			<div class="data">
				<table>
					{{#each history}}
						<tr>
							<td>{{formatDate this.timeUpdated}}</td>
							<td>{{formatNumber this.credits}}</td>
							<td>
								{{#if eq this.type 'chatFree'}}
									Не платить за ссаный чат
								{{/if}}
								{{#if eq this.type 'chatBalance'}}
									Пополнение баланса комнаты в чате
								{{/if}}
								{{#if eq this.type 'chatIcon'}}
									Покупка иконки для чата
								{{/if}}
								{{#if eq this.type 'planetRename'}}
									Переименование планеты
								{{/if}}
								{{#if eq this.type 'planetBuy'}}
									Покупка дополнительной колонии
								{{/if}}
								{{#if eq this.type 'card'}}
									Покупка карточки
								{{/if}}
								{{#if eq this.type 'unitBuild'}}
									Покупка юнитов
								{{/if}}
								{{#if eq this.type 'mutualInvest'}}
									Вложение в общие исследования
								{{/if}}
								{{#if eq this.type 'building'}}
									Постройка здания
								{{/if}}
								{{#if eq this.type 'researchStart'}}
									Покупка исследования
								{{/if}}
								{{#if eq this.type 'houseItem'}}
									Покупка предмета в палате
								{{/if}}
								{{#if eq this.type 'container'}}
									Покупка контейнера
								{{/if}}
								{{#if eq this.type 'sepukku'}}
									Сэппуку
								{{/if}}

								{{#if gt this.items.length 1}}
									({{this.items.length}})
								{{/if}}
							</td>
						</tr>
					{{/each}}
				</table>
			</div>

		{{/if}}

		{{> pages total=countTotal perPage=count}}

		{{#if isLoading}}
			{{> loading}}
		{{/if}}
	</div>
</template>

<template name="promocodeReward">
	<div class="smoke"></div>
	<div class="promocode">
		{{#if resources}}
			<ul class="resources">
				{{#each resources}}
					<li class="{{this.engName}}">
						{{formatNumber this.amount}}
					</li>
				{{/each}}
			</ul>
		{{/if}}
		{{#if artefacts}}
			<ul class="resources">
				{{#each artefacts}}
					<li class="{{this.engName}} artefact">
						{{formatNumber this.amount}}
					</li>
				{{/each}}
			</ul>
		{{/if}}
		{{#if units}}
			<ul class="units">
				{{#each units}}
					<li class="{{this.engName}}-icon">
						{{formatNumber this.amount}}
					</li>
				{{/each}}
			</ul>
		{{/if}}
		{{#if cards}}
			<ul class="cards">
				{{#each cards}}
					<li class="{{this.group}}-{{this.engName}}-icon">
						{{formatNumber this.amount}}
					</li>
				{{/each}}
			</ul>
		{{/if}}
		{{#if houseItems}}
			<ul class="houseItems">
				{{#each houseItems}}
					<li class="{{this.group}}-{{this.engName}}-icon"></li>
				{{/each}}
			</ul>
		{{/if}}
		{{#if containers}}
			{{#each containers}}
				<span class="containers">Бесплатный контейнер +{{this.amount}}</span>
			{{/each}}
		{{/if}}
		{{#if profit.votePower}}
			<span class="votepower">Сила голоса +{{profit.votePower}}</span>
		{{/if}}
		<span class="take">Награда</span>
	</div>
</template>

<template name="promocodeCreate">
	<div class="smoke"></div>
	<div class="promocodeCreate">
		<div class="close"></div>

		<label>
			<div class="title">Название кода</div>
			<input name="code" type="text"/>
		</label>
		<label>
			<div class="title">Количество активаций</div>
			<input name="maxActivations" type="text"/>
		</label>
		<label>
			<div class="title">Время действия (в минутах)</div>
			<input name="minutes" type="text"/>
		</label>
		<label>
			<div class="title">Тип кода</div>
			<input name="type" type="text"/>
		</label>
		<label>
			<div class="title">Рандомная награда</div>
			<input type="checkbox" name="random"/>
		</label>

		<ul class="profit">
			{{#each loopCount 10}}
				<li>
					<select>
						{{#each options}}
							<option name="{{this.id}}">{{this.name}}</option>
						{{/each}}
					</select>
					<input type="text"/>
				</li>
			{{/each}}
		</ul>

		<textarea class="script"></textarea>

		<div class="create">Создать</div>
	</div>
</template>

<template name="promocodeHistory">
	<div class="promocodeHistory">
		<a class="btn-close" href="{{pathFor 'house' group='house'}}"></a>
		<table>
			<tr class="header">
				<th>Код</th>
				<th>Награда</th>
				<th>{{#if username}}Активирован{{else}}Создан{{/if}}</th>
				{{#if not username}}
					<th>Годен до</th>
					<th>Активировано</th>
				{{/if}}
			</tr>
		</table>
		<div class="data">
			<table>
				{{#each history}}
					<tr>
						<td>{{this.code}}</td>
						<td>{{formatProfit this.profit}}</td>
						<td>{{#if this.timestamp}}{{formatDate this.timestamp}}{{/if}}</td>
						{{#if not ../username}}
							<td>{{#if this.validthru}}{{formatDate this.validthru}}{{/if}}</td>
							<td>{{this.activations}} из {{this.maxActivations}}</td>
						{{/if}}
					</tr>
				{{/each}}
			</table>
		</div>

		<input type="text" name="username" placeholder="Имя пользователя"/>
		<input type="text" name="code" placeholder="Промо код"/>

		{{> pages total=countTotal perPage=count}}

		{{#if isLoading}}
			{{> loading}}
		{{/if}}
	</div>
</template>